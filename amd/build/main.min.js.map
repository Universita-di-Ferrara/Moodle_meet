{"version":3,"file":"main.min.js","sources":["../src/main.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module main\n *\n * @module     mod_gmeet/main\n * @copyright  2024 YOUR NAME <your@email.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport ModalForm from 'core_form/modalform';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport { get_string as getString } from 'core/str';\nimport { getRecording, updateRecording, deleteRecording } from './ajax_call';\nimport { add as addToast } from 'core/toast';\n\nconst Selectors = {\n    actions: {\n        syncRecordings: '[data-action=\"mod_gmeet/sync_recordings\"]',\n        editRecording: '[data-role=editfield][data-id]',\n        deleteRecording: '[data-role=deletefield][data-id]'\n    },\n};\n\nconst asyncGetRecording = async (id, courseid) => {\n    const recording = await getRecording(id, courseid);\n    return recording;\n};\n\nconst asyncUpdateRecording = async (recording) => {\n    const response = await updateRecording(recording);\n    if (response.responsecode) {\n        window.location.reload(true);\n    }\n};\n\nconst asyncDeleteRecording = async (id, courseid) => {\n    const response = await deleteRecording(id, courseid);\n    if (response.responsecode) {\n        window.location.reload(true);\n    }\n};\n\n\nconst registerEventListeners = (deletemodal) => {\n    document.addEventListener('click', e => {\n        const editingRecordingelement = e.target.closest(Selectors.actions.editRecording);\n        const syncRecordingelement = e.target.closest(Selectors.actions.syncRecordings);\n        const deleteRecordingelement = e.target.closest(Selectors.actions.deleteRecording);\n        if (editingRecordingelement) {\n            e.preventDefault();\n            const recordingid = editingRecordingelement.getAttribute('data-id');\n            const courseid = editingRecordingelement.getAttribute('course-id');\n            asyncGetRecording(recordingid, courseid).then((values) => {\n                const modalForm = new ModalForm({\n                    // Name of the class where form is defined (must extend \\core_form\\dynamic_form):\n                    formClass: \"mod_gmeet\\\\recording_form\",\n                    // Add as many arguments as you need, they will be passed to the form:\n                    args: { id: recordingid,\n                            recordingname: values.name,\n                            recordingdescription: values.description,\n                            courseid: courseid,\n                        },\n                    // Pass any configuration settings to the modal dialogue, for example, the title:\n                    modalConfig: {\n                        title: getString('editingfield', 'mod_gmeet', editingRecordingelement.getAttribute('data-name'))\n                    },\n                    // DOM element that should get the focus after the modal dialogue is closed:\n                    returnFocus: editingRecordingelement,\n                });\n                modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, (e) => {\n                    const formdata = e.detail;\n                    addToast(getString('edittoast', 'mod_gmeet'));\n                    asyncUpdateRecording(formdata);\n                });\n                // Show the form.\n                modalForm.show();\n            });\n        }\n        if (syncRecordingelement) {\n            e.preventDefault();\n            addToast(getString('synctoast', 'mod_gmeet'));\n            const form = document.getElementById('syncForm');\n            form.submit();\n            syncRecordingelement.disabled = true;\n        }\n        if (deleteRecordingelement) {\n            const recordingid = deleteRecordingelement.getAttribute('data-id');\n            const courseid = deleteRecordingelement.getAttribute('course-id');\n            e.preventDefault();\n            deletemodal.show();\n            deletemodal.getRoot().on(ModalEvents.save, () => {\n                addToast(getString('deletetoast', 'mod_gmeet'),{\n                    type:'danger',\n                });\n                asyncDeleteRecording(recordingid, courseid);\n            });\n        }\n\n    });\n};\n\nexport const init =  async () => {\n    const deleteform = await ModalFactory.create({\n        type: ModalFactory.types.SAVE_CANCEL,\n        title: getString('delete_form_title','mod_gmeet'),\n        body: getString('delete_form_body','mod_gmeet'),\n        buttons:{\n            'save':getString('delete_form_button','mod_gmeet'),\n        }\n    });\n    registerEventListeners(deleteform);\n};\n"],"names":["Selectors","syncRecordings","editRecording","deleteRecording","registerEventListeners","deletemodal","document","addEventListener","e","editingRecordingelement","target","closest","syncRecordingelement","deleteRecordingelement","preventDefault","recordingid","getAttribute","courseid","async","id","asyncGetRecording","then","values","modalForm","ModalForm","formClass","args","recordingname","name","recordingdescription","description","modalConfig","title","returnFocus","events","FORM_SUBMITTED","formdata","detail","recording","responsecode","window","location","reload","asyncUpdateRecording","show","getElementById","submit","disabled","getRoot","on","ModalEvents","save","type","asyncDeleteRecording","deleteform","ModalFactory","create","types","SAVE_CANCEL","body","buttons"],"mappings":";;;;;;;gPA6BMA,kBACO,CACLC,eAAgB,4CAChBC,cAAe,iCACfC,gBAAiB,oCAwBnBC,uBAA0BC,cAC5BC,SAASC,iBAAiB,SAASC,UACzBC,wBAA0BD,EAAEE,OAAOC,QAAQX,kBAAkBE,eAC7DU,qBAAuBJ,EAAEE,OAAOC,QAAQX,kBAAkBC,gBAC1DY,uBAAyBL,EAAEE,OAAOC,QAAQX,kBAAkBG,oBAC9DM,wBAAyB,CACzBD,EAAEM,uBACIC,YAAcN,wBAAwBO,aAAa,WACnDC,SAAWR,wBAAwBO,aAAa,aA5BxCE,OAAOC,GAAIF,iBACT,2BAAaE,GAAIF,UA4BjCG,CAAkBL,YAAaE,UAAUI,MAAMC,eACrCC,UAAY,IAAIC,mBAAU,CAE5BC,UAAW,4BAEXC,KAAM,CAAEP,GAAIJ,YACJY,cAAeL,OAAOM,KACtBC,qBAAsBP,OAAOQ,YAC7Bb,SAAUA,UAGlBc,YAAa,CACTC,OAAO,mBAAU,eAAgB,YAAavB,wBAAwBO,aAAa,eAGvFiB,YAAaxB,0BAEjBc,UAAUhB,iBAAiBgB,UAAUW,OAAOC,gBAAiB3B,UACnD4B,SAAW5B,EAAE6B,uBACV,mBAAU,YAAa,cA3CvBnB,OAAAA,mBACF,8BAAgBoB,YAC1BC,cACTC,OAAOC,SAASC,QAAO,IAyCXC,CAAqBP,aAGzBb,UAAUqB,aAGdhC,qBAAsB,CACtBJ,EAAEM,iCACO,mBAAU,YAAa,cACnBR,SAASuC,eAAe,YAChCC,SACLlC,qBAAqBmC,UAAW,KAEhClC,uBAAwB,OAClBE,YAAcF,uBAAuBG,aAAa,WAClDC,SAAWJ,uBAAuBG,aAAa,aACrDR,EAAEM,iBACFT,YAAYuC,OACZvC,YAAY2C,UAAUC,GAAGC,sBAAYC,MAAM,qBAC9B,mBAAU,cAAe,aAAa,CAC3CC,KAAK,WAzDIlC,OAAOC,GAAIF,mBACb,8BAAgBE,GAAIF,WAC9BsB,cACTC,OAAOC,SAASC,QAAO,IAwDfW,CAAqBtC,YAAaE,gCAO7BC,gBACXoC,iBAAmBC,uBAAaC,OAAO,CACzCJ,KAAMG,uBAAaE,MAAMC,YACzB1B,OAAO,mBAAU,oBAAoB,aACrC2B,MAAM,mBAAU,mBAAmB,aACnCC,QAAQ,OACG,mBAAU,qBAAqB,gBAG9CxD,uBAAuBkD"}